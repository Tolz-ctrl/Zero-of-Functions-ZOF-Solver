<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOF Solver - Zero of Functions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">üßÆ Zero of Functions (ZOF) Solver</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Numerical Methods for Root Finding</h4>
                    </div>
                    <div class="card-body">
                        <form id="solverForm">
                            <!-- Equation Input -->
                            <div class="mb-3">
                                <label for="equation" class="form-label">Enter Equation f(x) = 0</label>
                                <input type="text" class="form-control" id="equation" name="equation" 
                                       placeholder="e.g., x**3 - x - 2  or  math.exp(x) - 3*x" required>
                                <small class="form-text text-muted">
                                    Use Python syntax: x**2 for x¬≤, math.sin(x), math.exp(x), math.sqrt(x), etc.
                                </small>
                            </div>

                            <!-- Method Selection -->
                            <div class="mb-3">
                                <label for="method" class="form-label">Select Numerical Method</label>
                                <select class="form-select" id="method" name="method" required>
                                    <option value="">-- Choose Method --</option>
                                    <option value="bisection">Bisection Method</option>
                                    <option value="regula_falsi">Regula Falsi (False Position)</option>
                                    <option value="secant">Secant Method</option>
                                    <option value="newton_raphson">Newton-Raphson Method</option>
                                    <option value="fixed_point">Fixed Point Iteration</option>
                                    <option value="modified_secant">Modified Secant Method</option>
                                </select>
                            </div>

                            <!-- Dynamic Input Fields -->
                            <div id="methodInputs"></div>

                            <!-- Tolerance and Max Iterations -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tolerance" class="form-label">Tolerance</label>
                                    <input type="number" class="form-control" id="tolerance" name="tolerance" 
                                           value="0.000001" step="any" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="max_iterations" class="form-label">Maximum Iterations</label>
                                    <input type="number" class="form-control" id="max_iterations" name="max_iterations" 
                                           value="100" min="1" required>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <span id="btnText">Solve Equation</span>
                                    <span id="btnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="row mt-4 d-none">
            <div class="col-md-12">
                <div class="card shadow">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">Results</h4>
                    </div>
                    <div class="card-body">
                        <!-- Summary -->
                        <div class="alert alert-success" id="resultSummary"></div>

                        <!-- Iteration Table -->
                        <h5 class="mt-4">Iteration Table</h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="iterationTable">
                                <thead class="table-dark">
                                    <tr id="tableHeader"></tr>
                                </thead>
                                <tbody id="tableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Section -->
        <div id="errorSection" class="row mt-4 d-none">
            <div class="col-md-12">
                <div class="alert alert-danger" role="alert">
                    <h5 class="alert-heading">Error!</h5>
                    <p id="errorMessage"></p>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-3 bg-light text-center">
        <p class="text-muted mb-0">ZOF Solver ¬© 2024 | Numerical Methods for Root Finding</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Method input templates
        const methodInputs = {
            bisection: `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="a" class="form-label">Lower Bound (a)</label>
                        <input type="number" class="form-control" id="a" name="a" step="any" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="b" class="form-label">Upper Bound (b)</label>
                        <input type="number" class="form-control" id="b" name="b" step="any" required>
                    </div>
                </div>
            `,
            regula_falsi: `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="a" class="form-label">Lower Bound (a)</label>
                        <input type="number" class="form-control" id="a" name="a" step="any" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="b" class="form-label">Upper Bound (b)</label>
                        <input type="number" class="form-control" id="b" name="b" step="any" required>
                    </div>
                </div>
            `,
            secant: `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="x0" class="form-label">First Initial Guess (x‚ÇÄ)</label>
                        <input type="number" class="form-control" id="x0" name="x0" step="any" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="x1" class="form-label">Second Initial Guess (x‚ÇÅ)</label>
                        <input type="number" class="form-control" id="x1" name="x1" step="any" required>
                    </div>
                </div>
            `,
            newton_raphson: `
                <div class="mb-3">
                    <label for="x0" class="form-label">Initial Guess (x‚ÇÄ)</label>
                    <input type="number" class="form-control" id="x0" name="x0" step="any" required>
                </div>
            `,
            fixed_point: `
                <div class="mb-3">
                    <label for="g_expr" class="form-label">Rearranged Function g(x) where x = g(x)</label>
                    <input type="text" class="form-control" id="g_expr" name="g_expr"
                           placeholder="e.g., math.sqrt(2) for f(x) = x**2 - 2" required>
                    <small class="form-text text-muted">
                        Rearrange f(x) = 0 to x = g(x) form
                    </small>
                </div>
                <div class="mb-3">
                    <label for="x0" class="form-label">Initial Guess (x‚ÇÄ)</label>
                    <input type="number" class="form-control" id="x0" name="x0" step="any" required>
                </div>
            `,
            modified_secant: `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="x0" class="form-label">Initial Guess (x‚ÇÄ)</label>
                        <input type="number" class="form-control" id="x0" name="x0" step="any" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="delta" class="form-label">Delta (Œ¥)</label>
                        <input type="number" class="form-control" id="delta" name="delta"
                               value="0.01" step="any" required>
                    </div>
                </div>
            `
        };

        // Update input fields based on selected method
        document.getElementById('method').addEventListener('change', function() {
            const method = this.value;
            const inputsDiv = document.getElementById('methodInputs');
            inputsDiv.innerHTML = methodInputs[method] || '';
        });

        // Form submission
        document.getElementById('solverForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show loading state
            document.getElementById('btnText').textContent = 'Solving...';
            document.getElementById('btnSpinner').classList.remove('d-none');
            document.getElementById('resultsSection').classList.add('d-none');
            document.getElementById('errorSection').classList.add('d-none');

            // Collect form data
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            try {
                const response = await fetch('/solve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    displayResults(result, data.method);
                } else {
                    displayError(result.error);
                }
            } catch (error) {
                displayError('Network error: ' + error.message);
            } finally {
                // Reset button state
                document.getElementById('btnText').textContent = 'Solve Equation';
                document.getElementById('btnSpinner').classList.add('d-none');
            }
        });

        function displayResults(result, method) {
            // Show results section
            document.getElementById('resultsSection').classList.remove('d-none');

            // Display summary
            const summary = `
                <h5>‚úÖ Root Found!</h5>
                <p><strong>Root (x):</strong> ${result.root.toFixed(10)}</p>
                <p><strong>f(x):</strong> ${result.fx.toExponential(6)}</p>
                <p><strong>Total Iterations:</strong> ${result.total_iterations}</p>
                <p><strong>Final Error:</strong> ${result.final_error.toExponential(6)}</p>
            `;
            document.getElementById('resultSummary').innerHTML = summary;

            // Build iteration table
            buildIterationTable(result.iterations, method);

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function buildIterationTable(iterations, method) {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');

            // Clear existing content
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';

            if (iterations.length === 0) return;

            // Get headers from first iteration
            const headers = Object.keys(iterations[0]);
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.charAt(0).toUpperCase() + header.slice(1);
                tableHeader.appendChild(th);
            });

            // Add rows
            iterations.forEach(iter => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = iter[header];
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        function displayError(message) {
            document.getElementById('errorSection').classList.remove('d-none');
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorSection').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>

